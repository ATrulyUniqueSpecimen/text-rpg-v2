# Project Structure & Architecture

## Overview
This project is a Text RPG built with **Next.js (React)** and **Ink** (using `inkjs`).
-   **Ink**: Handles the narrative flow, game logic (stats, inventory, combat calculations), and text generation.
-   **React**: Handles the UI rendering, state persistence (Local Storage), and visualizes the Ink state (sidebar, stats, inventory).

## Key Directories

```
.
├── app/
│   ├── components/         # UI Components
│   │   ├── Sidebar.tsx     # The main hud (stats, inventory)
│   │   ├── InventoryList.tsx
│   │   ├── PaperDoll.tsx   # Visual equipment representation
│   │   └── ...
│   ├── hooks/
│   │   ├── useInkGame.ts      # Core Hook: Manages Ink Story instance, saving/loading, and choice handling.
│   │   └── useEntityStats.ts  # Stats Hook: Parses Ink variables to drive the UI (HP/SP, Equipment, Sidebar).
│   └── page.tsx            # Main Game Loop & Layout
├── ink/
│   ├── story.ink           # Entry point
│   ├── systems/            # Game Systems (inventory.ink, stats.ink, npcs.ink)
│   ├── scenes/             # Narrative content
│   └── ...
├── public/
│   └── story.json          # Compiled Ink JSON (generated by Inklecate)
└── documentation/          # Guides for adding content
```

## State Management Flow

1.  **Ink is Truth**: The `inkjs` Story object holds the authoritative game state (variables, lists, current path).
2.  **Syncing**: The `useInkGame` hook calls `syncSidebar` (passed from `useEntityStats`) whenever the story continues or choices are made.
3.  **Visualization**: `syncSidebar` reads variables from Ink (e.g., `HP_CUR`, `inv`, `current_companion`) and updates React state.
4.  **Persistence**:
    *   **Save/Load**: handled by `useInkGame`.
    *   **Local Storage**: `ink_save_[1-3]`, `ink_achievements`, `ink_theme`.

## Adding Content
Allows for easy expansion of the game world. See specific guides:
*   [How to Add Items](./how_to_add_item.md)
*   [How to Add NPCs](./how_to_add_npc.md)
*   [How to Add Achievements](./how_to_add_achievement.md)

## Building & Running
1.  **Compile Ink**: `.\inklecate.exe -o public/story.json ink/story.ink`
2.  **Run Dev Server**: `npm run dev`
3.  **Build**: `npm run build`
